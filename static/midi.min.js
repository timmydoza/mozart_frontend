function Replayer(e,t,n,r){function o(){for(var t=null,n=null,r=null,o=0;i.length>o;o++)null!=i[o].ticksToNextEvent&&(null==t||t>i[o].ticksToNextEvent)&&(t=i[o].ticksToNextEvent,n=o,r=i[o].nextEventIndex);if(null!=n){var a=e.tracks[n][r];e.tracks[n][r+1]?i[n].ticksToNextEvent+=e.tracks[n][r+1].deltaTime:i[n].ticksToNextEvent=null,i[n].nextEventIndex+=1;for(var o=0;i.length>o;o++)null!=i[o].ticksToNextEvent&&(i[o].ticksToNextEvent-=t);return{ticksToEvent:t,event:a,track:n}}return null}function a(){function e(){s||"meta"!=d.event.type||"setTempo"!=d.event.subtype||(u=6e7/d.event.microsecondsPerBeat);var e=0,n=0;d.ticksToEvent>0&&(e=d.ticksToEvent/c,n=e/(u/60));var r=1e3*n*t||0;f.push([d,r]),d=o()}if(d=o())for(;d;)e(!0)}for(var i=[],u=r?r:120,s=r?!0:!1,c=e.header.ticksPerBeat,l=0;e.tracks.length>l;l++)i[l]={nextEventIndex:0,ticksToNextEvent:e.tracks[l].length?e.tracks[l][0].deltaTime:null};var d,f=[];return a(),{getData:function(){return clone(f)}}}function MidiFile(e){function t(e){var t=e.read(4),n=e.readInt32();return{id:t,length:n,data:e.read(n)}}function n(e){var t={};t.deltaTime=e.readVarInt();var n=e.readInt8();if(240==(240&n)){if(255==n){t.type="meta";var o=e.readInt8(),a=e.readVarInt();switch(o){case 0:if(t.subtype="sequenceNumber",2!=a)throw"Expected length for sequenceNumber event is 2, got "+a;return t.number=e.readInt16(),t;case 1:return t.subtype="text",t.text=e.read(a),t;case 2:return t.subtype="copyrightNotice",t.text=e.read(a),t;case 3:return t.subtype="trackName",t.text=e.read(a),t;case 4:return t.subtype="instrumentName",t.text=e.read(a),t;case 5:return t.subtype="lyrics",t.text=e.read(a),t;case 6:return t.subtype="marker",t.text=e.read(a),t;case 7:return t.subtype="cuePoint",t.text=e.read(a),t;case 32:if(t.subtype="midiChannelPrefix",1!=a)throw"Expected length for midiChannelPrefix event is 1, got "+a;return t.channel=e.readInt8(),t;case 47:if(t.subtype="endOfTrack",0!=a)throw"Expected length for endOfTrack event is 0, got "+a;return t;case 81:if(t.subtype="setTempo",3!=a)throw"Expected length for setTempo event is 3, got "+a;return t.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),t;case 84:if(t.subtype="smpteOffset",5!=a)throw"Expected length for smpteOffset event is 5, got "+a;var i=e.readInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&i],t.hour=31&i,t.min=e.readInt8(),t.sec=e.readInt8(),t.frame=e.readInt8(),t.subframe=e.readInt8(),t;case 88:if(t.subtype="timeSignature",4!=a)throw"Expected length for timeSignature event is 4, got "+a;return t.numerator=e.readInt8(),t.denominator=Math.pow(2,e.readInt8()),t.metronome=e.readInt8(),t.thirtyseconds=e.readInt8(),t;case 89:if(t.subtype="keySignature",2!=a)throw"Expected length for keySignature event is 2, got "+a;return t.key=e.readInt8(!0),t.scale=e.readInt8(),t;case 127:return t.subtype="sequencerSpecific",t.data=e.read(a),t;default:return t.subtype="unknown",t.data=e.read(a),t}return t.data=e.read(a),t}if(240==n){t.type="sysEx";var a=e.readVarInt();return t.data=e.read(a),t}if(247==n){t.type="dividedSysEx";var a=e.readVarInt();return t.data=e.read(a),t}throw"Unrecognised MIDI event type byte: "+n}var u;0==(128&n)?(u=n,n=r):(u=e.readInt8(),r=n);var s=n>>4;switch(t.channel=15&n,t.type="channel",s){case 8:return t.subtype="noteOff",t.noteNumber=u,t.velocity=e.readInt8(),t;case 9:return t.noteNumber=u,t.velocity=e.readInt8(),t.subtype=0==t.velocity?"noteOff":"noteOn",t;case 10:return t.subtype="noteAftertouch",t.noteNumber=u,t.amount=e.readInt8(),t;case 11:return t.subtype="controller",t.controllerType=u,t.value=e.readInt8(),t;case 12:return t.subtype="programChange",t.programNumber=u,t;case 13:return t.subtype="channelAftertouch",t.amount=u,t;case 14:return t.subtype="pitchBend",t.value=u+(e.readInt8()<<7),t;default:throw"Unrecognised MIDI event type: "+s}}var r;stream=Stream(e);var o=t(stream);if("MThd"!=o.id||6!=o.length)throw"Bad .mid file - header not found";var a=Stream(o.data),i=a.readInt16(),u=a.readInt16(),s=a.readInt16();if(32768&s)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=s;for(var c={formatType:i,trackCount:u,ticksPerBeat:ticksPerBeat},l=[],d=0;c.trackCount>d;d++){l[d]=[];var f=t(stream);if("MTrk"!=f.id)throw"Unexpected chunk - expected MTrk, got "+f.id;for(var p=Stream(f.data);!p.eof();){var m=n(p);l[d].push(m)}}return{header:c,tracks:l}}function Stream(e){function t(t){var n=e.substr(u,t);return u+=t,n}function n(){var t=(e.charCodeAt(u)<<24)+(e.charCodeAt(u+1)<<16)+(e.charCodeAt(u+2)<<8)+e.charCodeAt(u+3);return u+=4,t}function r(){var t=(e.charCodeAt(u)<<8)+e.charCodeAt(u+1);return u+=2,t}function o(t){var n=e.charCodeAt(u);return t&&n>127&&(n-=256),u+=1,n}function a(){return u>=e.length}function i(){for(var e=0;;){var t=o();if(!(128&t))return e+t;e+=127&t,e<<=7}}var u=0;return{eof:a,read:t,readInt32:n,readInt16:r,readInt8:o,readVarInt:i}}if("undefined"==typeof MIDI&&(MIDI={}),function(e){"use strict";var t={},n=0,r=function(e){n++;var r=document.body,o=new Audio,a=e.split(";")[0];o.id="audio",o.setAttribute("preload","auto"),o.setAttribute("audiobuffer",!0),o.addEventListener("error",function(){r.removeChild(o),t[a]=!1,n--},!1),o.addEventListener("canplaythrough",function(){r.removeChild(o),t[a]=!0,n--},!1),o.src="data:"+e,r.appendChild(o)};e.audioDetect=function(e){if(navigator.requestMIDIAccess){var o=Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]");if(o)t.webmidi=!0;else for(var a=0;navigator.plugins.length>a;a++){var i=navigator.plugins[a];i.name.indexOf("Jazz-Plugin")>=0&&(t.webmidi=!0)}}if("undefined"==typeof Audio)return e({});t.audiotag=!0,(window.AudioContext||window.webkitAudioContext)&&(t.webaudio=!0);var u=new Audio;if(u.canPlayType===void 0)return e(t);var s=u.canPlayType('audio/ogg; codecs="vorbis"');s="probably"===s||"maybe"===s;var c=u.canPlayType("audio/mpeg");if(c="probably"===c||"maybe"===c,!s&&!c)return e(t),void 0;s&&r("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),c&&r("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var l=(new Date).getTime(),d=window.setInterval(function(){var r=(new Date).getTime(),o=r-l>5e3;(!n||o)&&(window.clearInterval(d),e(t))},1)}}(MIDI),function(e){"use strict";e.GM=function(e){var t=function(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},n={byName:{},byId:{},byCategory:{}};for(var r in e)for(var o=e[r],a=0,i=o.length;i>a;a++){var u=o[a];if(u){var s=parseInt(u.substr(0,u.indexOf(" ")),10);u=u.replace(s+" ",""),n.byId[--s]=n.byName[t(u)]=n.byCategory[t(r)]={id:t(u),instrument:u,number:s,category:r}}}return n}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),e.getInstrument=function(t){var n=e.channels[t];return n&&n.instrument},e.setInstrument=function(t,n,r){var o=e.channels[t];return r?setTimeout(function(){o.instrument=n},r):(o.instrument=n,void 0)},e.getMono=function(t){var n=e.channels[t];return n&&n.mono},e.setMono=function(t,n,r){var o=e.channels[t];return r?setTimeout(function(){o.mono=n},r):(o.mono=n,void 0)},e.getOmni=function(t){var n=e.channels[t];return n&&n.omni},e.setOmni=function(t,n){var r=e.channels[t];return delay?setTimeout(function(){r.omni=n},delay):(r.omni=n,void 0)},e.getSolo=function(t){var n=e.channels[t];return n&&n.solo},e.setSolo=function(t,n){var r=e.channels[t];return delay?setTimeout(function(){r.solo=n},delay):(r.solo=n,void 0)},e.channels=function(){for(var e={},t=0;16>t;t++)e[t]={instrument:t,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}(),e.keyToNote={},e.noteToKey={},function(){for(var t=21,n=108,r=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],o=t;n>=o;o++){var a=(o-12)/12>>0,i=r[o%12]+a;e.keyToNote[i]=o,e.noteToKey[o]=i}}()}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),MIDI.Soundfont=MIDI.Soundfont||{},MIDI.Player=MIDI.Player||{},function(e){"use strict";e.DEBUG=!0,e.USE_XHR=!0,e.soundfontUrl="./soundfont/",e.loadPlugin=function(n){"function"==typeof n&&(n={onsuccess:n}),e.soundfontUrl=n.soundfontUrl||e.soundfontUrl,e.audioDetect(function(r){var o=window.location.hash,a="";if(r[n.api]?a=n.api:r[o.substr(1)]?a=o.substr(1):r.webmidi?a="webmidi":window.AudioContext?a="webaudio":window.Audio&&(a="audiotag"),t[a]){if(n.targetFormat)var i=n.targetFormat;else var i=r["audio/ogg"]?"ogg":"mp3";e.__api=a,e.__audioFormat=i,e.supports=r,e.loadResource(n)}})},e.loadResource=function(n){var r=n.instruments||n.instrument||"acoustic_grand_piano";"object"!=typeof r&&(r=r||0===r?[r]:[]);for(var o=0;r.length>o;o++){var a=r[o];a===+a&&e.GM.byId[a]&&(r[o]=e.GM.byId[a].id)}n.format=e.__audioFormat,n.instruments=r,t[e.__api](n)};var t={webmidi:function(t){e.WebMIDI.connect(t)},audiotag:function(e){n(e,"AudioTag")},webaudio:function(e){n(e,"WebAudio")}},n=function(t,n){for(var o=t.format,a=t.instruments,i=t.onprogress,u=t.onerror,s=a.length,c=s,l=function(){--c||(i&&i("load",1),e[n].connect(t))},d=0;s>d;d++){var f=a[d];MIDI.Soundfont[f]?l():r(a[d],o,function(e,t){var n=t/s,r=(s-c)/s;i&&i("load",n+r,f)},function(){l()},u)}},r=function(t,n,r,o,a){var i=e.soundfontUrl+t+"-"+n+".js";e.USE_XHR?e.util.request({url:i,format:"text",onerror:a,onprogress:r,onsuccess:function(e,t){var n=document.createElement("script");n.language="javascript",n.type="text/javascript",n.text=t,document.body.appendChild(n),o()}}):dom.loadScript.add({url:i,verify:'MIDI.Soundfont["'+t+'"]',onerror:a,onsuccess:function(){o()}})};e.setDefaultPlugin=function(t){for(var n in t)e[n]=t[n]}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),MIDI.Player===void 0&&(MIDI.Player={}),function(){"use strict";var e=MIDI.Player;e.currentTime=0,e.endTime=0,e.restart=0,e.playing=!1,e.timeWarp=1,e.startDelay=0,e.BPM=120,e.start=e.resume=function(t){-1>e.currentTime&&(e.currentTime=-1),d(e.currentTime,null,t)},e.pause=function(){var t=e.restart;f(),e.restart=t},e.stop=function(){f(),e.restart=0,e.currentTime=0},e.addListener=function(e){i=e},e.removeListener=function(){i=void 0},e.clearAnimation=function(){e.animationFrameId&&cancelAnimationFrame(e.animationFrameId)},e.setAnimation=function(t){var n=0,r=0,o=0;e.clearAnimation();var i=function(){if(e.animationFrameId=requestAnimationFrame(i),0!==e.endTime){e.playing?(n=o===e.currentTime?r-Date.now():0,n=0===e.currentTime?0:e.currentTime-n,o!==e.currentTime&&(r=Date.now(),o=e.currentTime)):n=e.currentTime;var u=e.endTime,s=n/1e3,c=s/60,l=s-60*c,d=60*c+l,f=u/1e3;-1>f-d||t({now:d,end:f,events:a})}};requestAnimationFrame(i)},e.loadMidiFile=function(t,n,r){try{e.replayer=new Replayer(MidiFile(e.currentData),e.timeWarp,null,e.BPM),e.data=e.replayer.getData(),e.endTime=c(),MIDI.loadPlugin({onsuccess:t,onprogress:n,onerror:r})}catch(o){r&&r(o)}},e.loadFile=function(t,n,r,o){if(e.stop(),-1!==t.indexOf("base64,")){var a=window.atob(t.split(",")[1]);e.currentData=a,e.loadMidiFile(n,r,o)}else{var i=new XMLHttpRequest;i.open("GET",t),i.overrideMimeType("text/plain; charset=x-user-defined"),i.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var t=this.responseText||"",a=[],i=t.length,u=String.fromCharCode,s=0;i>s;s++)a[s]=u(255&t.charCodeAt(s));var c=a.join("");e.currentData=c,e.loadMidiFile(n,r,o)}else o&&o("Unable to load MIDI file")},i.send()}},e.getFileInstruments=function(){for(var t={},n={},r=0;e.data.length>r;r++){var o=e.data[r][0].event;if("channel"===o.type){var a=o.channel;switch(o.subtype){case"controller":break;case"programChange":n[a]=o.programNumber;break;case"noteOn":var i=n[a],u=MIDI.GM.byId[isFinite(i)?i:a];t[u.id]=!0}}}var s=[];for(var c in t)s.push(c);return s};var t,n,r=[],o=0,a={},i=void 0,u=function(n,o,u,s,c,l){return setTimeout(function(){var s={channel:n,note:o,now:u,end:e.endTime,message:c,velocity:l};128===c?delete a[o]:a[o]=s,i&&i(s),e.currentTime=u,r.shift(),1e3>r.length?d(t,!0):e.currentTime===t&&e.endTime>t&&d(t,!0)},u-s)},s=function(){return"webaudio"===MIDI.api?MIDI.WebAudio.getContext():(e.ctx={currentTime:0},e.ctx)},c=function(){for(var t=e.data,n=t.length,r=.5,o=0;n>o;o++)r+=t[o][1];return r},l=function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},d=function(a,i,d){if(e.replayer){i||(a===void 0&&(a=e.restart),e.playing&&f(),e.playing=!0,e.data=e.replayer.getData(),e.endTime=c());var p,m=0,A=0,v=e.data,h=s(),y=v.length;t=.5,r[0]&&r[0].interval||0;var g=a-e.currentTime;if("webaudio"!==MIDI.api){var q=l();n=n||q,h.currentTime=(q-n)/1e3}o=h.currentTime;for(var I=0;y>I&&100>A;I++){var b=v[I];if(a>=(t+=b[1]))m=t;else{a=t-m;var S=b[0].event;if("channel"===S.type){var T=S.channel,w=MIDI.channels[T],M=h.currentTime+(a+g+e.startDelay)/1e3,x=t-m+e.startDelay;switch(S.subtype){case"controller":MIDI.setController(T,S.controllerType,S.value,M);break;case"programChange":MIDI.programChange(T,S.programNumber,M);break;case"pitchBend":MIDI.pitchBend(T,S.value,M);break;case"noteOn":if(w.mute)break;p=S.noteNumber-(e.MIDIOffset||0),r.push({event:S,time:x,source:MIDI.noteOn(T,S.noteNumber,S.velocity,M),interval:u(T,p,t+e.startDelay,m-g,144,S.velocity)}),A++;break;case"noteOff":if(w.mute)break;p=S.noteNumber-(e.MIDIOffset||0),r.push({event:S,time:x,source:MIDI.noteOff(T,S.noteNumber,M),interval:u(T,p,t,m-g,128,0)});break;default:}}}}d&&d(r)}},f=function(){var t=s();for(e.playing=!1,e.restart+=1e3*(t.currentTime-o);r.length;){var n=r.pop();window.clearInterval(n.interval),n.source&&("number"==typeof n.source?window.clearTimeout(n.source):n.source.disconnect(0))}for(var u in a){var n=a[u];144===a[u].message&&i&&i({channel:n.channel,note:n.note,now:n.now,end:n.end,message:128,velocity:n.velocity})}a={}}}(),function(e){"use strict";window.Audio&&function(){for(var t=e.AudioTag={api:"audiotag"},n={},r=127,o=-1,a=[],i=[],u={},s=0;12>s;s++)a[s]=new Audio;var c=function(t,n){if(e.channels[t]){var s=e.channels[t].instrument,c=e.GM.byId[s].id,n=u[n];if(n){var l=c+""+n.id,d=(o+1)%a.length,f=a[d];if(i[d]=l,!e.Soundfont[c])return e.DEBUG&&console.log("404",c),void 0;f.src=e.Soundfont[c][n.id],f.volume=r/127,f.play(),o=d}}},l=function(t,n){if(e.channels[t]){var r=e.channels[t].instrument,s=e.GM.byId[r].id,n=u[n];if(n)for(var c=s+""+n.id,l=0,d=a.length;d>l;l++){var f=(l+o+1)%d,p=i[f];if(p&&p==c)return a[f].pause(),i[f]=null,void 0}}};t.audioBuffers=a,t.send=function(){},t.setController=function(){},t.setVolume=function(e,t){r=t},t.programChange=function(t,n){e.channels[t].instrument=n},t.pitchBend=function(){},t.noteOn=function(e,t,r,o){var a=n[t];if(u[a])return o?setTimeout(function(){c(e,a)},1e3*o):(c(e,a),void 0)},t.noteOff=function(){},t.chordOn=function(e,t,r,o){for(var a=0;t.length>a;a++){var i=t[a],s=n[i];if(u[s]){if(o)return setTimeout(function(){c(e,s)},1e3*o);c(e,s)}}},t.chordOff=function(e,t,r){for(var o=0;t.length>o;o++){var a=t[o],i=n[a];if(u[i]){if(r)return setTimeout(function(){l(e,i)},1e3*r);l(e,i)}}},t.stopAllNotes=function(){for(var e=0,t=a.length;t>e;e++)a[e].pause()},t.connect=function(r){e.setDefaultPlugin(t);for(var o in e.keyToNote)n[e.keyToNote[o]]=o,u[o]={id:o};r.onsuccess&&r.onsuccess()}}()}(MIDI),function(e){"use strict";window.AudioContext&&function(){function t(e,t,n){if(o){var a=new Audio;a.src=e,a.controls=!1,a.autoplay=!1,a.preload=!1,a.addEventListener("canplay",function(){t&&t(a)}),a.addEventListener("error",function(e){n&&n(e)}),document.body.appendChild(a)}else if(0===e.indexOf("data:audio")){var i=e.split(",")[1],u=Base64Binary.decodeArrayBuffer(i);r.decodeAudioData(u,t,n)}else{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){r.decodeAudioData(s.response,t,n)},s.send()}}function n(){return new(window.AudioContext||window.webkitAudioContext)}var r,o=!1,a=e.WebAudio={api:"webaudio"},i={},u={},s=127,c={};a.audioBuffers=c,a.send=function(){},a.setController=function(){},a.setVolume=function(e,t,n){n?setTimeout(function(){s=t},1e3*n):s=t},a.programChange=function(t,n){var r=e.channels[t];r.instrument=n},a.pitchBend=function(t,n){var r=e.channels[t];r.pitchBend=n},a.noteOn=function(t,n,a,l){l=l||0;var d=e.channels[t],f=d.instrument,p=f+""+n,m=c[p];if(m){if(r.currentTime>l&&(l+=r.currentTime),o)var A=r.createMediaElementSource(m);else{var A=r.createBufferSource();A.buffer=m}if(u){var v=A;for(var h in u)v.connect(u[h].input),v=u[h]}var y=2*a/127*(s/127)-1;if(A.connect(r.destination),A.playbackRate.value=1,A.gainNode=r.createGain(),A.gainNode.connect(r.destination),A.gainNode.gain.value=Math.min(1,Math.max(-1,y)),A.connect(A.gainNode),o){if(l)return setTimeout(function(){m.currentTime=0,m.play()},1e3*l);m.currentTime=0,m.play()}else A.start(l||0);return i[t+""+n]=A,A}},a.noteOff=function(t,n,a){a=a||0;var u=e.channels[t],s=u.instrument,l=s+""+n,d=c[l];if(d){r.currentTime>a&&(a+=r.currentTime);var f=i[t+""+n];if(f){if(f.gainNode){var p=f.gainNode.gain;p.linearRampToValueAtTime(p.value,a),p.linearRampToValueAtTime(-1,a+.3)}return o?a?setTimeout(function(){d.pause()},1e3*a):d.pause():f.noteOff?f.noteOff(a+.5):f.stop(a+.5),delete i[t+""+n],f}}},a.chordOn=function(e,t,n,r){for(var o,i={},u=0,s=t.length;s>u;u++)i[o=t[u]]=a.noteOn(e,o,n,r);return i},a.chordOff=function(e,t,n){for(var r,o={},i=0,u=t.length;u>i;i++)o[r=t[i]]=a.noteOff(e,r,n);return o},a.stopAllNotes=function(){for(var e in i){var t=0;r.currentTime>t&&(t+=r.currentTime);var n=i[e];n.gain.linearRampToValueAtTime(1,t),n.gain.linearRampToValueAtTime(0,t+.3),n.noteOff?n.noteOff(t+.3):n.stop(t+.3),delete i[e]}},a.setEffects=function(e){if(!r.tunajs)return console.log("Effects module not installed.");for(var t=0;e.length>t;t++){var n=e[t],o=new r.tunajs[n.type](n);o.connect(r.destination),u[n.type]=o}},a.connect=function(t){e.setDefaultPlugin(a),a.setContext(r||n(),t.onsuccess)},a.getContext=function(){return r},a.setContext=function(n,o){r=n,"undefined"==typeof Tuna||r.tunajs||(r.tunajs=new Tuna(r));var a=[],i=e.keyToNote;for(var u in i)a.push(u);var s=function(){for(var e in d)if(d[e])return;o&&(o(),o=null)},l=function(n,r,o,a){var i=n[a];i&&(d[r]++,t(i,function(t){t.id=a;var o=e.keyToNote[a];c[r+""+o]=t,0===--d[r]&&(n.isLoaded=!0,s(f))},function(){}))},d={};for(var f in e.Soundfont){var p=e.Soundfont[f];if(!p.isLoaded){var m=e.GM.byName[f],A=m.number;d[A]=0;for(var v=0;a.length>v;v++){var u=a[v];l(p,A,v,u)}}}setTimeout(s,1)}}()}(MIDI),function(e){"use strict";var t=null,n=null,r=e.WebMIDI={api:"webmidi"};r.send=function(e,t){n.send(e,1e3*t)},r.setController=function(e,t,r,o){n.send([e,t,r],1e3*o)},r.setVolume=function(e,t,r){n.send([176+e,7,t],1e3*r)},r.programChange=function(e,t,r){n.send([192+e,t],1e3*r)},r.pitchBend=function(e,t,r){n.send([224+e,t],1e3*r)},r.noteOn=function(e,t,r,o){n.send([144+e,t,r],1e3*o)},r.noteOff=function(e,t,r){n.send([128+e,t,0],1e3*r)},r.chordOn=function(e,t,r,o){for(var a=0;t.length>a;a++){var i=t[a];n.send([144+e,i,r],1e3*o)}},r.chordOff=function(e,t,r){for(var o=0;t.length>o;o++){var a=t[o];n.send([128+e,a,0],1e3*r)}},r.stopAllNotes=function(){n.cancel();for(var e=0;16>e;e++)n.send([176+e,123,0])},r.connect=function(o){e.setDefaultPlugin(r);var a=function(){if(window.AudioContext)o.api="webaudio";else{if(!window.Audio)return;o.api="audiotag"}e.loadPlugin(o)};navigator.requestMIDIAccess().then(function(e){t=e;var r=t.outputs;n="function"==typeof r?r()[0]:r[0],void 0===n?a():o.onsuccess&&o.onsuccess()},a)}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),function(e){var t=e.util||(e.util={});if(t.request=function(t,r,o,a){"use strict";"string"==typeof t&&(t={url:t});var i=t.data,u=t.url,s=t.method||(t.data?"POST":"GET"),c=t.format,l=t.headers,d=t.responseType,f=t.withCredentials||!1,r=r||t.onsuccess,o=o||t.onerror,a=a||t.onprogress;if(n!==void 0&&e.loc.isLocalUrl(u))return n.readFile(u,"utf8",function(e,t){e?o&&o(e):r&&r({responseText:t})}),void 0;var p=new XMLHttpRequest;if(p.open(s,u,!0),l)for(var m in l)p.setRequestHeader(m,l[m]);else i&&p.setRequestHeader("Content-type","application/x-www-form-urlencoded");return"binary"===c&&p.overrideMimeType&&p.overrideMimeType("text/plain; charset=x-user-defined"),d&&(p.responseType=d),f&&(p.withCredentials="true"),o&&"onerror"in p&&(p.onerror=o),a&&p.upload&&"onprogress"in p.upload&&(i?p.upload.onprogress=function(e){a.call(p,e,event.loaded/event.total)}:p.addEventListener("progress",function(e){var t=0;if(e.lengthComputable)t=e.total;else if(p.totalBytes)t=p.totalBytes;else{var n=parseInt(p.getResponseHeader("Content-Length-Raw"));if(!isFinite(n))return;p.totalBytes=t=n}a.call(p,e,e.loaded/t)})),p.onreadystatechange=function(t){if(4===p.readyState)if(200===p.status||304===p.status||308===p.status||0===p.status&&e.client.cordova){if(r){var n;if("xml"===c)n=t.target.responseXML;else if("text"===c)n=t.target.responseText;else if("json"===c)try{n=JSON.parse(t.target.response)}catch(a){o&&o.call(p,t)}r.call(p,t,n)}}else o&&o.call(p,t)},p.send(i),p},"undefined"!=typeof module&&module.exports){var n=require("fs");XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=e.util.request}}(MIDI),dom===void 0)var dom={};(function(){"use strict";dom.loadScript=function(){return this.loaded={},this.loading={},this},dom.loadScript.prototype.add=function(t){var n=this;"string"==typeof t&&(t={url:t});var r=t.urls;r===void 0&&(r=[{url:t.url,verify:t.verify}]);var o=document.getElementsByTagName("head")[0],a=function(t,r){n.loaded[t.url]||r&&e(r)===!1||(n.loaded[t.url]=!0,n.loading[t.url]&&n.loading[t.url](),delete n.loading[t.url],t.onsuccess&&t.onsuccess(),f!==void 0&&f())},i=!1,u=[],s=function(e){if("string"==typeof e&&(e={url:e,verify:t.verify}),/([\w\d.\[\]\'\"])$/.test(e.verify)){var r=e.test=e.verify;if("object"==typeof r)for(var s=0;r.length>s;s++)u.push(r[s]);else u.push(r)}if(!n.loaded[e.url]){var l=document.createElement("script");l.onreadystatechange=function(){("loaded"===this.readyState||"complete"===this.readyState)&&a(e)},l.onload=function(){a(e)},l.onerror=function(){if(i=!0,delete n.loading[e.url],"object"==typeof e.test)for(var t in e.test)c(e.test[t]);else c(e.test)},l.setAttribute("type","text/javascript"),l.setAttribute("src",e.url),o.appendChild(l),n.loading[e.url]=function(){}}},c=function(e){for(var t=[],n=0;u.length>n;n++)u[n]!==e&&t.push(u[n]);u=t},l=function(n){if(n)a(n,n.test);else for(var o=0;r.length>o;o++)a(r[o],r[o].test);for(var s=!0,o=0;u.length>o;o++)e(u[o])===!1&&(s=!1);!t.strictOrder&&s?i?t.error&&t.error():t.onsuccess&&t.onsuccess():setTimeout(function(){l(n)},10)};if(t.strictOrder){var d=-1,f=function(){if(d++,r[d]){var e=r[d],o=e.url;n.loading[o]?n.loading[o]=function(){e.onsuccess&&e.onsuccess(),f()}:n.loaded[o]?f():(s(e),l(e))}else i?t.error&&t.error():t.onsuccess&&t.onsuccess()};f()}else for(var d=0;r.length>d;d++)s(r[d]),l(r[d])},dom.loadScript=new dom.loadScript;var e=function(e,t){try{e=e.split('"').join("").split("'").join("").split("]").join("").split("[").join(".");for(var n=e.split("."),r=n.length,o=t||window,a=0;r>a;a++){var i=n[a];if(null==o[i])return!1;o=o[i]}return!0}catch(u){return!1}}})(),"undefined"!=typeof module&&module.exports&&(module.exports=dom.loadScript),function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=Error(),e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var r,o,a=0,i=n,u="";t.charAt(0|a)||(i="=",a%1);u+=i.charAt(63&r>>8-8*(a%1))){if(o=t.charCodeAt(a+=.75),o>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|o}return u}),t.atob||(t.atob=function(t){if(t=t.replace(/=+$/,""),1==t.length%4)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,o,a=0,i=0,u="";o=t.charAt(i++);~o&&(r=a%4?64*r+o:o,a++%4)?u+=String.fromCharCode(255&r>>(6&-2*a)):0)o=n.indexOf(o);return u})}();var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=Math.ceil(3*e.length/4),n=new ArrayBuffer(t);return this.decode(e,n),n},decode:function(e,t){var n=this._keyStr.indexOf(e.charAt(e.length-1)),r=this._keyStr.indexOf(e.charAt(e.length-1)),o=Math.ceil(3*e.length/4);64==n&&o--,64==r&&o--;var a,i,u,s,c,l,d,f,p=0,m=0;for(a=t?new Uint8Array(t):new Uint8Array(o),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;o>p;p+=3)c=this._keyStr.indexOf(e.charAt(m++)),l=this._keyStr.indexOf(e.charAt(m++)),d=this._keyStr.indexOf(e.charAt(m++)),f=this._keyStr.indexOf(e.charAt(m++)),i=c<<2|l>>4,u=(15&l)<<4|d>>2,s=(3&d)<<6|f,a[p]=i,64!=d&&(a[p+1]=u),64!=f&&(a[p+2]=s);return a}},clone=function(e){if("object"!=typeof e)return e;if(null==e)return e;var t="number"==typeof e.length?[]:{};for(var n in e)t[n]=clone(e[n]);return t};